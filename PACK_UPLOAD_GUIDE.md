# Руководство по загрузке паков вопросов

## Обзор

Телеграм-бот теперь поддерживает загрузку паков вопросов из YAML файлов. Это позволяет легко добавлять новые викторины без необходимости использовать API напрямую.

## Как загрузить пак через Telegram бот

1. **Запустите команду загрузки:**
   ```
   /uploadpack
   ```

2. **Отправьте YAML файл:**
   - Бот попросит вас отправить файл
   - Файл должен иметь расширение `.yaml` или `.yml`
   - Отправьте файл как документ (не как фото)

3. **Дождитесь подтверждения:**
   - Бот загрузит файл на сервер
   - Вы получите подтверждение с ID созданного пака
   - Теперь пак доступен для игры через `/newgame`

## Формат YAML файла

### Базовая структура

```yaml
title: Название вашего пака
questions:
  - text: Текст первого вопроса
    variants:
      - text: Вариант ответа 1
      - text: Правильный ответ
        is_correct: true
      - text: Вариант ответа 3
      - text: Вариант ответа 4
  
  - text: Текст второго вопроса
    variants:
      - text: Неправильный ответ
      - text: Правильный ответ
        is_correct: true
```

### Поля

#### Обязательные поля:

- **`title`** (string): Название пака вопросов
- **`questions`** (array): Массив вопросов
  - **`text`** (string): Текст вопроса
  - **`variants`** (array): Массив вариантов ответа (минимум 2)
    - **`text`** (string): Текст варианта ответа
    - **`is_correct`** (boolean): `true` для правильного ответа (по умолчанию `false`)

#### Опциональные поля:

- **`image_url`** (string): URL изображения для вопроса

### Пример с изображением

```yaml
title: Викторина с картинками
questions:
  - text: Что изображено на картинке?
    image_url: https://example.com/image.jpg
    variants:
      - text: Кот
        is_correct: true
      - text: Собака
      - text: Птица
```

## Полный пример файла

См. файл [`example_pack.yaml`](example_pack.yaml) для полного примера.

## Технические детали

### Backend API

Бот использует endpoint `/packs/yaml` для загрузки паков:

- **URL:** `POST http://localhost:8080/packs/yaml`
- **Content-Type:** `text/plain`
- **Body:** Содержимое YAML файла

### Реализация в боте

Новые функции в [`bot.py`](bot.py):

1. **`GameAPI.upload_pack_from_yaml(yaml_content)`** - отправляет YAML на сервер
2. **`upload_pack_command()`** - обработчик команды `/uploadpack`
3. **`handle_pack_file()`** - обработчик загруженного файла

### Состояния ConversationHandler

Добавлено новое состояние `UPLOADING_PACK` для процесса загрузки пака.

## Устранение неполадок

### Ошибка "Invalid YAML format"

- Проверьте синтаксис YAML (отступы, двоеточия)
- Убедитесь, что все обязательные поля присутствуют
- Используйте YAML валидатор онлайн

### Ошибка "Pack title is required"

- Убедитесь, что поле `title` присутствует и не пустое

### Ошибка при загрузке файла

- Проверьте, что файл имеет расширение `.yaml` или `.yml`
- Убедитесь, что файл в кодировке UTF-8
- Проверьте, что backend сервер запущен и доступен

## Команды бота

- `/start` - Начать работу с ботом
- `/newgame` - Создать новую игру
- `/uploadpack` - Загрузить новый пак вопросов
- `/cancel` - Отменить текущую операцию
- `/help` - Показать справку

## Примеры использования

### Создание простого пака

```yaml
title: Простая викторина
questions:
  - text: 2 + 2 = ?
    variants:
      - text: "3"
      - text: "4"
        is_correct: true
      - text: "5"
```

### Создание пака с несколькими вопросами

```yaml
title: Викторина по истории
questions:
  - text: В каком году началась Вторая мировая война?
    variants:
      - text: "1938"
      - text: "1939"
        is_correct: true
      - text: "1940"
      - text: "1941"
  
  - text: Кто был первым президентом США?
    variants:
      - text: Томас Джефферсон
      - text: Джордж Вашингтон
        is_correct: true
      - text: Авраам Линкольн
      - text: Бенджамин Франклин
```

## Ограничения

- Максимальный размер файла определяется настройками Telegram (обычно 20 МБ)
- Каждый вопрос должен иметь минимум 2 варианта ответа
- Только один вариант может быть отмечен как правильный (`is_correct: true`)
- Если ни один вариант не отмечен как правильный, все варианты считаются неправильными

## Дополнительная информация

Для получения дополнительной информации о backend API см.:
- [`create_pack_from_yaml.cpp`](../../backend/src/handlers/content_handling/pack/create_pack_from_yaml.cpp)
- [`static_config.yaml`](../../backend/configs/static_config.yaml)